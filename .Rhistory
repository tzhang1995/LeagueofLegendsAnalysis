preds[[i]] <- predict.glm(models[[i]], type = "response", newdata = goldRange)
if(champions$win[[i]] == "high"){
plot <- plot %>%
add_trace(
x = goldRange$goldEarned,
y = preds[[i]],
type = "scatter",
mode = "lines",
name = champions$championName[[i]]
)
} else if(champion$win[[i]] == "low"){
plot <- plot %>%
add_trace(
x = goldRange$goldEarned,
y = preds[[i]],
type = "scatter",
mode = "lines",
name = champions$championName[[i]],
line = list(dash = "dash")
)
}
}
plot <- plot %>%
layout(
xaxis = list(title = "Gold Percent"),
yaxis = list(title ="Predicted Probability of Winning"),
title = paste0("Top and Bottom 3 Winrate Champions (", str_to_title(ROLE), ")")
)
return(plot)
}
winrate$tables$WR_highlow <- data.temp$WR_highlow.temp %>%
mutate(
plot = map2(
ROLE,
table,
.f = GET_WR_PLOTS
)
)
winrate$tables$WR_highlow <- data.temp$WR_highlow.temp %>%
mutate(
plot = pmap(
.,
.f = GET_WR_PLOTS
)
)
GET_WR_PLOTS <- function(ROLE, table, table2 = winrate$tables$highlow, ...){
models <- list()
preds <- list()
goldRange <- data.frame(goldEarned = seq(0, .75, length.out = 75))
champions <- table %>%
distinct(championName) %>%
left_join(
table2,
by = "championName"
)
plot <- plot_ly()
for(i in 1:nrow(champions)){
models[[i]] <- table %>%
filter(championName == champions$championName[[i]]) %>%
filter(individualPosition == ROLE) %>%
glm(formula = win~goldEarned, family = "binomial", data = .)
preds[[i]] <- predict.glm(models[[i]], type = "response", newdata = goldRange)
if(champions$win[[i]] == "high"){
plot <- plot %>%
add_trace(
x = goldRange$goldEarned,
y = preds[[i]],
type = "scatter",
mode = "lines",
name = champions$championName[[i]]
)
} else if(champion$win[[i]] == "low"){
plot <- plot %>%
add_trace(
x = goldRange$goldEarned,
y = preds[[i]],
type = "scatter",
mode = "lines",
name = champions$championName[[i]],
line = list(dash = "dash")
)
}
}
plot <- plot %>%
layout(
xaxis = list(title = "Gold Percent"),
yaxis = list(title ="Predicted Probability of Winning"),
title = paste0("Top and Bottom 3 Winrate Champions (", str_to_title(ROLE), ")")
)
return(plot)
}
winrate$tables$WR_highlow <- data.temp$WR_highlow.temp %>%
mutate(
plot = pmap(
.,
.f = GET_WR_PLOTS
)
)
GET_WR_DATA <- function(ROLE, TABLE1 = data.temp$goldPercent, TABLE2 = winrate$tables$highlow){
glm_data <- TABLE1 %>%
filter(
championName %in% (TABLE2 %>%
filter(individualPosition == ROLE) %>%
{.$championName})
) %>%
return()
}
GET_WR_MODEL <- function(table){
glm(win ~ championName*goldEarned, data = table, family = "binomial") %>%
return()
}
GET_WR_PLOTS <- function(ROLE, table, table2 = winrate$tables$highlow, ...){
models <- list()
preds <- list()
goldRange <- data.frame(goldEarned = seq(0, .75, length.out = 75))
champions <- table %>%
distinct(championName) %>%
left_join(
table2,
by = "championName"
)
plot <- plot_ly()
for(i in 1:nrow(champions)){
models[[i]] <- table %>%
filter(championName == champions$championName[[i]]) %>%
filter(individualPosition == ROLE) %>%
glm(formula = win~goldEarned, family = "binomial", data = .)
preds[[i]] <- predict.glm(models[[i]], type = "response", newdata = goldRange)
if(champions$win[[i]] == "high"){
plot <- plot %>%
add_trace(
x = goldRange$goldEarned,
y = preds[[i]],
type = "scatter",
mode = "lines",
name = champions$championName[[i]]
)
} else if(champions$win[[i]] == "low"){
plot <- plot %>%
add_trace(
x = goldRange$goldEarned,
y = preds[[i]],
type = "scatter",
mode = "lines",
name = champions$championName[[i]],
line = list(dash = "dash")
)
}
}
plot <- plot %>%
layout(
xaxis = list(title = "Gold Percent"),
yaxis = list(title ="Predicted Probability of Winning"),
title = paste0("Top and Bottom 3 Winrate Champions (", str_to_title(ROLE), ")")
)
return(plot)
}
winrate$tables$WR_highlow <- data.temp$WR_highlow.temp %>%
mutate(
plot = pmap(
.,
.f = GET_WR_PLOTS
)
)
winrate$tables$WR_highlow$plot
winrate$tables$WR_highlow$plot
winrate$plots$covariate
winrate$tables$covariate.temp <- expand.grid(
champions.scraped$name,
champions.scraped$name
) %>%
apply(., 1, sort) %>% # Removing rows symmetrically, no need to double search
t() %>%
unique() %>%
as_tibble() %>%
rename(Champ1 = V1, Champ2 = V2) %>%
filter(Champ1 != Champ2) # Removing diagonal elements
# This takes SO damn long to run, I wonder if there is a better way to do this...
# Doing this in two steps to avoid running long functions again
winrate$tables$covariate.temp2 <- winrate$tables$covariate.temp %>%
mutate(
gameList = pmap(
.,
.f = function(Champ1, Champ2, TABLE = data.temp$champTeams){
TABLE %>%
group_by(match, win) %>%
filter(champion == Champ1) %>% # Okay this is way faster but still turbo slow
filter(str_detect(team, paste0("_", Champ2, "_"))) %>%
ungroup() %>%
return()
}
)
)
winrate$tables$covariate <- winrate$tables$covariate.temp2 %>%
mutate(
data = map(
gameList,
.f = function(gameList){
gameList %>%
summarize(winrate = mean(win), games = n()) %>%
return()
}
)
) %>%
unnest(cols = c(data))
# Making a new table to make searching particular champion pairs easier
winrate$tables$covariate.search <- bind_rows(
winrate$tables$covariate,
winrate$tables$covariate %>%
rename(Champ2 = 1, Champ1 = 2)
)
winrate$plots$covariate <- winrate$tables$covariate %>%
plot_ly(
x = ~games,
y = ~winrate,
text = ~paste(Champ1, Champ2, sep = " "),
type = "scatter",
mode = "markers"
)
winrate$plots$covariate
winrate$plots$base
winrate$tables$base <- gameInfo.win %>%
group_by(championName) %>%
summarize(winrate = mean(win), games = n(), .groups = "drop")
head(winrate$tables$base)
winrate$plots$base <- winrate$tables$base %>%
left_join(
champions.scraped,
by = c("championName" = "name")
) %>%
plot_ly(
x = ~games,
y = ~winrate,
color = ~tag,
text = ~championName,
type = "scatter",
mode = "markers"
)
winrate$plots$base
winrate$plots$base
winrate$tables$covariate.temp
winrate$tables$covariate.temp %>% filter(champ1 == "Akshan")
winrate$tables$covariate.temp %>% filter(Champ1 == "Akshan")
library(tidyverse)
library(jsonlite)
library(httr)
library(rvest)
library(tidyverse)
library(sjPlot)
library(plotly)
library(plotly)
library(RColorBrewer)
library(data.table)
library(cluster)
winrate$tables$tier %>%
filter(championName == "MasterYi")
winrate$tables$tier %>%
filter(championName %in% c("Rammus", "MasterYi", "Skarner"))
champions.scraped
champions.scraped %>%
filter(champions %in% winrate$tables$WR_highlow$championName)
winrate$tables$highlow
champions.scraped %>%
filter(champions %in% winrate$tables$highlow$championName)
champions.scraped %>%
filter(championName %in% winrate$tables$highlow$championName)
champions.scraped
champions.scraped %>%
filter(name %in% winrate$tables$highlow$championName)
champions.scraped %>%
right_join(
winrate$tables$highlow,
by = c("name" = "championName")
)
champions.scraped %>%
right_join(
winrate$tables$highlow,
by = c("name" = "championName")
) %>%
arrange(individualPosition)
champions.scraped %>%
right_join(
winrate$tables$highlow,
by = c("name" = "championName")
) %>%
arrange(individualPosition, win)
champions.scraped
winrate$tables$base %>%
left_join(
champions.scraped %>%
select(!tag),
by = c("championName" = "name")
)
winrate$tables$base %>%
left_join(
champions.scraped %>%
select(!tag),
by = c("championName" = "name")
) %>%
ggplot(aes(x = difficulty, y = winrate)) + geom_point()
winrate$tables$base %>%
left_join(
champions.scraped %>%
select(!tag),
by = c("championName" = "name")
) %>%
ggplot(aes(x = difficulty, y = winrate)) + geom_boxplot()
?geom_errorbar
winrate$tables$base %>%
left_join(
champions.scraped %>%
select(!tag),
by = c("championName" = "name")
) %>%
group_by(difficulty) %>%
summarize(winrate = mean(winrate), sd = sd(winrate), n = n(), .groups = "drop") %>%
mutate(sem = sd / sqrt(n)) %>%
ggplot(aes(x = difficulty, y = winrate)) +
geom_point() +
geom_errorbar(aes(ymin = winrate - sem, ymax = winrate + sem))
winrate$tables$base %>%
left_join(
champions.scraped %>%
select(!tag),
by = c("championName" = "name")
) %>%
group_by(difficulty) %>%
summarize(winrate = mean(winrate), sd = sd(winrate), n = n(), .groups = "drop") %>%
mutate(sem = sd / sqrt(n))
winrate$tables$base %>%
left_join(
champions.scraped %>%
select(!tag),
by = c("championName" = "name")
) %>%
group_by(difficulty) %>%
summarize(sd = sd(winrate), n = n(), .groups = "drop") %>%
mutate(sem = sd / sqrt(n))
# ggplot(aes(x = difficulty, y = winrate)) +
# geom_point() +
# geom_errorbar(aes(ymin = winrate - sem, ymax = winrate + sem))
winrate$tables$base %>%
left_join(
champions.scraped %>%
select(!tag),
by = c("championName" = "name")
) %>%
group_by(difficulty) %>%
summarize(sd = sd(winrate), winrate = mean(winrate), n = n(), .groups = "drop") %>%
mutate(sem = sd / sqrt(n))
# ggplot(aes(x = difficulty, y = winrate)) +
# geom_point() +
# geom_errorbar(aes(ymin = winrate - sem, ymax = winrate + sem))
winrate$tables$base %>%
left_join(
champions.scraped %>%
select(!tag),
by = c("championName" = "name")
) %>%
group_by(difficulty) %>%
summarize(sd = sd(winrate), winrate = mean(winrate), n = n(), .groups = "drop") %>%
mutate(sem = sd / sqrt(n)) %>%
ggplot(aes(x = difficulty, y = winrate)) +
geom_point() +
geom_errorbar(aes(ymin = winrate - sem, ymax = winrate + sem))
winrate$tables$difficulty <- winrate$tables$base %>%
left_join(
champions.scraped %>%
select(!tag),
by = c("championName" = "name")
) %>%
group_by(difficulty) %>%
summarize(sd = sd(winrate), winrate = mean(winrate), n = n(), .groups = "drop") %>%
mutate(sem = sd / sqrt(n))
winrate$tables %>%
ggplot(aes(x = difficulty, y = winrate)) +
geom_point() +
geom_errorbar(aes(ymin = winrate - sem, ymax = winrate + sem)) %>%
ggplotly()
winrate$tables$difficulty <- winrate$tables$base %>%
left_join(
champions.scraped %>%
select(!tag),
by = c("championName" = "name")
) %>%
group_by(difficulty) %>%
summarize(sd = sd(winrate), winrate = mean(winrate), n = n(), .groups = "drop") %>%
mutate(sem = sd / sqrt(n))
winrate$tables$difficulty %>%
ggplot(aes(x = difficulty, y = winrate)) +
geom_point() +
geom_errorbar(aes(ymin = winrate - sem, ymax = winrate + sem)) %>%
ggplotly()
winrate$tables$difficulty <- winrate$tables$base %>%
left_join(
champions.scraped %>%
select(!tag),
by = c("championName" = "name")
) %>%
group_by(difficulty) %>%
summarize(sd = sd(winrate), winrate = mean(winrate), n = n(), .groups = "drop") %>%
mutate(sem = sd / sqrt(n))
winrate$tables$difficulty %>%
ggplot(aes(x = difficulty, y = winrate)) +
geom_point() +
geom_errorbar(aes(ymin = winrate - sem, ymax = winrate + sem)) +
ggplotly()
winrate$tables$difficulty <- winrate$tables$base %>%
left_join(
champions.scraped %>%
select(!tag),
by = c("championName" = "name")
) %>%
group_by(difficulty) %>%
summarize(sd = sd(winrate), winrate = mean(winrate), n = n(), .groups = "drop") %>%
mutate(sem = sd / sqrt(n))
(winrate$tables$difficulty %>%
ggplot(aes(x = difficulty, y = winrate)) +
geom_point() +
geom_errorbar(aes(ymin = winrate - sem, ymax = winrate + sem))) %>%
ggplotly()
winrate$tables$difficulty %>%
ggplot(aes(x = difficulty, y = winrate)) +
geom_point() +
geom_errorbar(aes(ymin = winrate - sem, ymax = winrate + sem))
winrta
winrate$tables$difficulty
?geom_errorbar
winrate$tables$difficulty %>%
ggplot(aes(x = difficulty, y = winrate)) +
geom_point() +
geom_errorbar(aes(ymin = winrate - sem, ymax = winrate + sem, size = 4))
winrate$tables$difficulty %>%
ggplot(aes(x = difficulty, y = winrate)) +
geom_point() +
geom_errorbar(aes(ymin = winrate - sem, ymax = winrate + sem, size = 1))
winrate$tables$difficulty %>%
ggplot(aes(x = difficulty, y = winrate)) +
geom_point() +
geom_errorbar(aes(ymin = winrate - sem, ymax = winrate + sem), size = 4)
winrate$tables$difficulty %>%
ggplot(aes(x = difficulty, y = winrate)) +
geom_point() +
geom_errorbar(aes(ymin = winrate - sem, ymax = winrate + sem), size = 1)
winrate$tables$difficulty %>%
ggplot(aes(x = difficulty, y = winrate)) +
geom_point() +
geom_errorbar(aes(ymin = winrate - sem, ymax = winrate + sem), width = .2)
winrate$tables$difficulty %>%
ggplot(aes(x = difficulty, y = winrate)) +
geom_point() +
geom_errorbar(aes(ymin = winrate - sem, ymax = winrate + sem), width = .4)
winrate$tables$difficulty %>%
ggplot(aes(x = difficulty, y = winrate)) +
geom_point() +
geom_errorbar(aes(ymin = winrate - sem, ymax = winrate + sem), width = .3)
winrate$tables$difficulty <- winrate$tables$base %>%
left_join(
champions.scraped %>%
select(!tag),
by = c("championName" = "name")
)
winrate$tables$difficulty %>%
group_by(difficulty) %>%
summarize(sd = sd(winrate), winrate = mean(winrate), n = n(), .groups = "drop") %>%
mutate(sem = sd / sqrt(n)) %>%
ggplot(aes(x = difficulty, y = winrate)) +
geom_point() +
geom_errorbar(aes(ymin = winrate - sem, ymax = winrate + sem), width = .3)
winrate$tables$difficulty
winrate$tables$difficulty %>%
aov(winrate~difficulty, data = .)
winrate$tables$difficulty %>%
aov(winrate~difficulty, data = .) %>%
summary()
?TukeyHSD
winrate$tables$difficulty %>%
aov(winrate~difficulty, data = .) %>%
summary()
# So differences definetly exist
winrate$tables$difficulty %>%
aov(winrate~difficulty, data = .) %>%
TukeyHSD()
winrate$tables$difficulty %>%
aov(winrate~difficulty, data = .) %>%
TukeyHSD() %>%
{.$difficulty} %>%
as_tibble()
winrate$tables$difficulty %>%
aov(winrate~difficulty, data = .) %>%
TukeyHSD() %>%
{.$difficulty}
winrate$tables$difficulty %>%
aov(winrate~difficulty, data = .) %>%
TukeyHSD() %>%
{.$difficulty} %>%
data.frame()
?as_tibble
winrate$tables$difficulty %>%
aov(winrate~difficulty, data = .) %>%
TukeyHSD() %>%
{.$difficulty} %>%
data.frame() %>%
as_tibble()
winrate$tables$difficulty %>%
aov(winrate~difficulty, data = .) %>%
TukeyHSD() %>%
{.$difficulty} %>%
as_tibble(rownames = "comparison")
?TukeyHSD
library(tidyverse)
library(keras)
