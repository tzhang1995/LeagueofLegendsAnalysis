---
title: "Basic Statistical Models"
output: html_notebook
---

This notebook outlines my process of generating basic statistical models and exploratory data analysis. This notebook is dependent on the data table gameInfo generated from DataExtraction.RMD.

# Packages
```{r}
library(sjPlot)
```

# Empty Lists to Store Results
```{r}
# Don't run this again or else you'll clear the data, commented out to avoid this problem :<
# results <- list(
#   models = list(),
#   plots = list()
# )
```

# Vision Score
Let's examine the effect of vision score on predicted probability of winning. If the theory is true that controlling vision is integral for winning (which by all intuition it should be) then higher vision score should increase the log odds of victory.
## Just Vision Score
```{r}
results$models$visionScore <- glm(win ~ visionScore, family = "binomial", data = gameInfo)

summary(results$models$visionScore)
```
```{r}
results$plots$visionScore <- plot_model(results$models$visionScore, type = "pred", grid = F)

results$plots$visionScore
```
So as expected, increasing vision score *does* appear to increase your chances of victor. So for every point of vision score, the log odds of winning increases by 0.0096 and at a vision score of ~23.4, your win chance is 50%. But what if we wanted to include role (adc, support, etc.)? Is it more important for a particular role to have a high vision score? It should be noted that the average and standard deviation of vision score is 23.49 and 19.96 respectively, so the large vision scores above 100 are very rare and the win rate should not be taken as accurate.

## Include Role
```{r}
results$models$visionScore.role <- glm(win ~ visionScore*individualPosition, family = "binomial", data = gameInfo %>% filter(individualPosition != "Invalid"))

summary(results$models$visionScore.role)
```
```{r}
results$plots$visionScore.role <- plot_model(results$models$visionScore.role, type = "int")

results$plots$visionScore.role
```
As it turns out, having laners / junglers that ward is a very strong indicator of success. If your laners / jungler have a vision score of less than 25, they are *actively* trolling. Let's see if we can add time as a covariate to have a more prescriptive intervention that can be made for league players.

## Include Game Time
```{r}
results$models$visionScore.role.time <- glm(win ~ visionScore*individualPosition*timePlayed, data = gameInfo %>% filter(individualPosition != "Invalid"), family = "binomial")

summary(results$models$visionScore.role.time)
```

# Gold Percentage by Position
It's a common idea that the ADC role has been considered useless for this season - let's see what the data has to say about that!
```{r}
data.temp$goldPercent <- gameInfo %>% 
  group_by(match, win) %>% # here win is just used to group team
  mutate(team_gold = sum(goldEarned), goldEarned = goldEarned / team_gold) %>% 
  ungroup()

results$models$goldPercent <- glm(win ~ goldEarned*individualPosition, data = data.temp$goldPercent %>% filter(individualPosition != "Invalid"), family = "binomial")

summary(results$models$goldPercent)
```
```{r}
results$plots$goldPercent <- plot_model(results$models$goldPercent, type = "int")

results$plots$goldPercent 
```

So it would appear that having your carry fed is actually a very strong indicator of win percentage. So why might people believe that ADC is useless? Let's add tier as a covariate and see what we see. (Also as a note, winrate drops off a cliff if support steals all the gold so good to know...as a support main)
## Add tier
```{r}
results$models$goldPercent.tier <- glm(win~goldEarned*individualPosition*tier, data = data.temp$goldPercent %>% filter(individualPosition != "Invalid"), family = "binomial")

summary(results$models$goldPercent.tier)
```
```{r}
results$plots$goldPercent.tier <- plot_model(results$models$goldPercent.tier, type = "int")

results$plots$goldPercent.tier[[4]]
```
Results are unclear, for lower elo's *in general*, gold percentage is less important on ADC but it's not super clear based on the the variance in Silver and Platinum. Interestingly, jungle seems to be a hard carry role in higher elos. Might be because of the champion choice. This will be examined later.
# Total Damage Done
```{r}
results$models$damageDoneChamp <- glm(win~totalDamageDealtToChampions*individualPosition, data = gameInfo %>% filter(individualPosition != "Invalid"), family = "binomial")

summary(results$models$damageDoneChamp)
```
```{r}
results$plots$damageDoneChamp <- plot_model(damageDoneChamp.fit, type = "int")

results$plots$damageDoneChamp
```
Not much difference based on whoever does damage to champion aside from support.
## Average Total Damage and Damage to Champions based on Role
```{r}
data.temp$damageDone <- gameInfo %>% 
  filter(individualPosition != "Invalid") %>% 
  select(individualPosition, totalDamageDealtToChampions, totalDamageDealt)
data.temp$damageDone %>% 
  ggplot(aes(x = individualPosition, y = totalDamageDealt)) +
  geom_boxplot()
data.temp$damageDone %>%  
  ggplot(aes(x = individualPosition, y = totalDamageDealtToChampions)) +
  geom_boxplot()
data.temp$damageDone %>% 
  filter(individualPosition != "Invalid") %>% 
  group_by(individualPosition) %>% 
  summarize(avg_damage_champ = mean(totalDamageDealtToChampions), avg_damage_total = mean(totalDamageDealt))
```
## Kruskal-Wallis Test
```{r}
kruskal.test(totalDamageDealt~individualPosition, data = data.temp$damageDone)
pairwise.wilcox.test(data.temp$damageDone$totalDamageDealt, data.temp$damageDone$individualPosition, p.adjust.method = "fdr")
```
Not really useful, sample size is so large which makes any small difference significant. Visual analysis of boxplots probably more useful.

# Champion Difficulty
```{r}
data.temp$championDifficulty <- gameInfo %>% 
  left_join(
    champions %>% 
      filter(!(id %in% c("Seraphine", "Rell"))) %>%  # These two champions have no associated difficulty
      select(difficulty, key),
    by = c("championId" = "key")
  ) %>% 
  filter(!is.na(difficulty))

results$models$championDifficulty <- glm(win ~ difficulty*tier, data = data.temp$championDifficulty, family = "binomial")

summary(results$models$championDifficulty)
```
Hard to say - I might have expected that win rate of difficult champions would increase, hard to say - difficulty does not take into account meta and other interactions. Will look at champion statistics next.

